# KubeJS Integration Guide

Thermal Shock features deep KubeJS integration. This guide details the parameter specifications for all JS recipe methods, chainable methods, and their streamlined syntax.

---

## 1. Core Parameter Rules
To keep scripts concise, we employ a **"Lean Constructor + Chainable Calls"** design pattern:
*   **Required Items**: Placed within the parentheses `()`. If a certain parameter is not needed (e.g., block inputs), an empty array `[]` must be passed as a placeholder.
*   **Optional Items**: Appended using `.methodName()`. If not called, mod default values are used.
*   **Ordering Rule**: Base data (outputs, inputs) comes first, followed by numerical data (such as thermal stress).

---

## 2. Core Physical Quantities
When configuring recipes involving temperature, it is essential to understand the physical meaning of the following values and their determinations:

### A. For the Simulation Chamber
*   **High Temp Rate**: The total input rate from all positive heat sources (e.g., Lava, Heat Generators) around the machine. This is a **positive number**.
*   **Low Temp Rate**: The total input rate from all negative cold sources (e.g., Ice, Cold Generators) around the machine. This is a **negative number**.
*   **Thermal Stress (ΔT)**: The **core threshold** for starting processing. Formula: `ΔT = High Temp Rate - Low Temp Rate`.

### B. For the Thermal Converter
*   **Net Heat Rate**: The algebraic sum of heat and cold provided by surrounding energy sources. This value can be positive or negative.

---

## 3. Overheating (`overheating`)
Uses sustained high temperatures to melt or transform items.

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `result` | ItemStack | **Yes** | Output item. Supports `3x item` shorthand. |
| 2 | `item_inputs` | Array | **Yes** | List of item inputs. Use `[]` if none. |
| 3 | `block_inputs` | Array | **Yes** | List of block inputs. Supports **fluid blocks** (e.g., `minecraft:water`). |

### Available Chainable Methods
| Method | Parameter Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `.minHeat(val)` | Integer | `0` | Minimum net heat input rate (H/t) required to start. |
| `.heatCost(val)` | Integer | `100` | Total cumulative heat (H) required to process this recipe. |

### Example
```js
// 3.1 Basic Smelting (using default heat thresholds)
event.recipes.thermalshock.overheating('minecraft:charcoal', ['#minecraft:logs'], [])

// 3.2 Advanced Processing (specifying high heat requirement and high consumption)
event.recipes.thermalshock.overheating('9x iron_nugget', ['iron_ingot'], [])
     .minHeat(500)
     .heatCost(2000)

// 3.3 Processing involving fluid blocks (e.g., Drying)
// Note: If [Simulation Upgrade] is installed, fluid blocks in block_inputs will automatically 
// be pulled from the interface fluid slots (1000mB).
event.recipes.thermalshock.overheating('sponge', [], ['minecraft:water'])
     .heatCost(50)
```

---

## 4. Thermal Shock (`thermal_shock`)
Uses the thermal stress generated by extremely high and low heat sources to shatter matter.

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `result` | ItemStack | **Yes** | Output item. |
| 2 | `item_inputs` | Array | **Yes** | List of item inputs. |
| 3 | `block_inputs` | Array | **Yes** | List of block inputs. |
| 4 | `delta` | Integer | **Yes** | **Thermal Stress (ΔT)**. Minimum rate difference required to start. |

### Available Chainable Methods
| Method | Parameter Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `.minHot(val)` | Integer | Unchecked | Minimum input rate (H/t) required from high temp sources. |
| `.maxCold(val)` | Integer | Unchecked | Maximum input rate (H/t) allowed from low temp sources. Should be negative or very small. |

### Example
```js
// 4.1 Basic Shattering
event.recipes.thermalshock.thermal_shock('sand', ['gravel'], [], 50)

// 4.2 Shattering in extreme environments (restricting to extremely hot or cold environments)
event.recipes.thermalshock.thermal_shock('obsidian', [], ['minecraft:lava'], 800)
     .minHot(1000)
     .maxCold(0)
```

---

## 5. Clump Filling (Thermal Shock) (`thermal_shock_filling`)
Encodes output data into a Material Clump via Thermal Shock.
 - Note: A `thermalshock:material_clump` must be provided as input.

*The system will automatically append `thermalshock:material_clump` to the inputs.*

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `target_item` | String | **Yes** | The item ID eventually encoded into the clump. |
| 2 | `item_inputs` | Array | **Yes** | List of item inputs. |
| 3 | `block_inputs` | Array | **Yes** | List of block inputs. |
| 4 | `delta` | Integer | **Yes** | **Thermal Stress (ΔT)**. Minimum temp difference required for filling. |

### Available Chainable Methods
| Method | Parameter Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `.targetCount(val)`| Integer | `1` | Quantity of the target item extracted from the clump. |
| `.minHot(val)` | Integer | None | High temp source input rate requirement. |
| `.maxCold(val)` | Integer | None | Low temp source input rate requirement. |

### Example
```js
// 5.1 Basic Filling
event.recipes.thermalshock.thermal_shock_filling('iron_ingot', ['iron_ore'], [], 700)

// 5.2 Bulk Filling (setting output quantity upon extraction)
event.recipes.thermalshock.thermal_shock_filling('gold_nugget', ['raw_gold'], [], 500)
     .targetCount(4)
```

---

## 6. Clump Filling (Crafting Table) (`clump_filling`)
Manually fills clumps in a Crafting Table. Inherits vanilla shaped recipe logic.
- Note: A `thermalshock:material_clump` must be provided as input.

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `target_item` | String | **Yes** | Encoded product ID. |
| 2 | `pattern` | Array | **Yes** | Shaped crafting pattern. |
| 3 | `key` | Map | **Yes** | Character-to-item mapping. |

### Convenience Feature
To simplify writing, if no `C` mapping is defined in `key`, the system will **automatically map `C` to `thermalshock:material_clump` (uppercase "C")**.

### Example
```js
// 6.1 Extremely Concise: Using built-in 'C' mapping
event.recipes.thermalshock.clump_filling('iron_ingot', [
    ' I ',
    ' C '
], {
    I: 'iron_ore'
})

// 6.2 Explicit Definition and Complex Pattern
event.recipes.thermalshock.clump_filling('gold_ingot', [
    'GGG',
    'GCG',
    'GGG'
], {
    G: 'gold_nugget',
    C: 'thermalshock:material_clump'
})
```

---

## 7. Clump Extraction (`clump_processing`)
Restores items from an encoded clump.
*Note: The system automatically appends the encoded `thermalshock:material_clump` to the inputs.*

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `result` | ItemStack | **Yes** | Final output item stack. |
| 2 | `target_item` | String | **Yes** | Only clumps encoded with this ID will be processed. |
| 3 | `item_inputs` | Array | **Yes** | Additional item consumption. |
| 4 | `block_inputs` | Array | **Yes** | Additional block consumption. |

### Available Chainable Methods
| Method | Parameter Type | Default | Description |
| :--- | :--- | :--- | :--- |
| `.minHeat(val)` | Integer | `0` | Minimum net heat input rate required for extraction. |
| `.heatCost(val)` | Integer | `100` | Total cumulative heat required for extraction. |

### Example
```js
// 7.1 Routine Extraction (clump only)
event.recipes.thermalshock.clump_processing('gold_ingot', 'gold_ingot', [], [])

// 7.2 Reinforced Extraction (requires extra materials and high heat consumption)
event.recipes.thermalshock.clump_processing('netherite_ingot', 'netherite_ingot', ['gold_ingot'], [])
     .minHeat(300)
     .heatCost(5000)
```

---

## 8. Thermal Converter (`thermal_converter`)
Precision single-block conversion, supporting multiple items/fluids and probabilities.

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `item_outputs` | Map/Array | **Yes** | Item outputs. Recommended map syntax: `{ "id": probability }`. |
| 2 | `item_inputs` | Map/Array | **Yes** | Item inputs. Recommended map syntax: `{ "id": consumption_probability }`. |
| 3 | `process_time` | Integer | **Yes** | Processing duration (ticks). Default is 20. |

### Available Chainable Methods
| Method | Parameter Type | Description |
| :--- | :--- | :--- |
| `.fluidInput(val)` | String/Map | Adds fluid input. Supports `1000x water` format. |
| `.fluidOutput(val)`| String/Map | Adds fluid output. Supports `100x lava` format. |
| `.chance(val)` | Double | Sets probability for the **most recently added** item via chainable methods. |
| `.minHeat(val)` | Integer | Sets the minimum net heat input rate for operation. |
| `.maxHeat(val)` | Integer | Sets the maximum net heat input rate for operation. |

### Example
```js
// 8.1 Smooth Map Syntax (Multiple outputs + Probability)
event.recipes.thermalshock.thermal_converter(
    { "gold_ingot": 1.0, "2x gold_nugget": 0.5 }, 
    "raw_gold", 
    200
)

// 8.2 Chained Fluid and Probability Tracking
event.recipes.thermalshock.thermal_converter("obsidian", "cobblestone", 100)
     .fluidInput("1000x water").chance(0.8) // 0.8 probability applied to water
     .fluidOutput("100x lava").chance(0.1)  // 0.1 probability applied to lava
     .minHeat(500)
```

---

## 9. Thermal Fuel (`thermal_fuel`)
Defines fuel properties for heat/cold sources.

### Positional Parameters (Constructor)
| Position | Name | Type | Required | Description |
| :--- | :--- | :--- | :--- | :--- |
| 1 | `ingredient` | Ingredient | **Yes** | Fuel item or tag. |
| 2 | `burn_time` | Integer | **Yes** | Combustion duration (ticks). |
| 3 | `heat_rate` | Integer | **Yes** | Heat generation/absorption rate (H/t). Positive for heat, negative for cold. |

### Example
```js
event.recipes.thermalshock.thermal_fuel('coal', 1600, 20) // Generates heat
event.recipes.thermalshock.thermal_fuel('blue_ice', 4800, -100) // Generates cold
```

---

## 10. Data Maps Integration
Used to dynamically define core thermal properties for blocks and items. **Must be listened to in `server_scripts`.**

### A. Structural Casing (`registerCasing`)
Defines the physical properties and flux limits of blocks when used as Simulation Chamber casings.
*   `event.add(block, maxHeat, maxCold, efficiency)`
    *   `maxHeat`: **High Temp Input Limit (H/t)**. Maximum heat rate allowed through the casing.
    *   `maxCold`: **Low Temp Input Limit (H/t)**. Maximum cold rate allowed through the casing (absolute value).
    *   `efficiency`: **Structural Efficiency (1.0 as baseline)**. Affects **catalyst consumption rate**. Higher efficiency reduces catalyst point consumption per unit of output.

```js
ThermalShockEvents.registerCasing(event => {
    event.add('minecraft:obsidian', 1000, -500, 0.5)
})
```

### B. Simulation Catalyst (`registerCatalyst`)
Defines the potency and points of items when used as simulation chamber catalysts.
`event.add(item, bonus, buffer)`
*   `bonus`: **Yield Bonus Coefficient** (e.g., 0.5 means the catalyst increases yield by 50%).
*   `buffer`: **Catalyst Points**. How many processing points (uses) the item provides.

```js
ThermalShockEvents.registerCatalyst(event => {
    // Endow Ender Pearl with catalyst potency: +80% yield, 500 points
    event.add('minecraft:ender_pearl', 0.8, 500)
})
```

### C. Thermal Source Properties
Defines the output power of blocks when placed near machines.

*   **Heat Source (`registerHeatSource`)**: `event.add(block, rate)` (Positive)
*   **Cold Source (`registerColdSource`)**: `event.add(block, rate)`
    *   **Note**: Enter `rate` as a **positive number** (representing cooling power); the code logic handles it as a subtraction.

```js
ThermalShockEvents.registerColdSource(event => {
    // Give ice blocks cooling capability: Entering 50 results in -50 H/t received by the machine.
    event.add('minecraft:ice', 50) 
})
```

---

## 11. Summary of Helper Features
*   **Placeholders**: Parameters not used in constructors must be filled with `[]`.
*   **Shorthand Support**: Strings support `3x item` and `1000x fluid` formats.
*   **Simulation Upgrade Features**: In Simulation Chambers, if `block_inputs` are fluid blocks, they will automatically support interface fluid automation upon installation of upgrades.
